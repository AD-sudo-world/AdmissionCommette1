{% extends "main/base.html" %}
{% load static %}

{% block content %}
<h1 class="hero-title">
    ПОДАЧА ЗАЯВЛЕНИЯ ИГХТУ
</h1>

<form method="POST" action="{% url 'statements:addStatements' %}">
    {% csrf_token %}
    
    <div class="application-form">
        <div class="form-group">
            <label for="faculty">Факультет</label>
            <select id="faculty" name="faculty" class="form-input" required>
                <option value="">Выберите факультет</option>
                {% for faculty in faculties %}
                <option value="{{ faculty.id }}">{{ faculty.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="direction">Направление</label>
            <select id="direction" name="direction" class="form-input" required>
                <option value="">Сначала выберите факультет</option>
            </select>
        </div>
        
        <div id="exams-container" class="form-group">
            <label>Требуемые экзамены</label>
            <div id="required-exams">
                <!-- Сюда будут загружаться экзамены через AJAX -->
                <p class="text-muted">Выберите направление для отображения экзаменов</p>
            </div>
        </div>
    </div>
    
    <div class="hero-buttons">
        <button type="submit" class="hero-button-one">Подать заявление</button>
        <a class="hero-button-two" href="{% url 'statements:index' %}">Отмена</a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const facultySelect = document.getElementById('faculty');
    const directionSelect = document.getElementById('direction');
    
    // Загрузка направлений при выборе факультета
    facultySelect.addEventListener('change', function() {
        const facultyId = this.value;
        directionSelect.innerHTML = '<option value="">Загрузка...</option>';
        
        if (facultyId) {
            fetch(`/api/directions/?faculty_id=${facultyId}`)
                .then(response => response.json())
                .then(data => {
                    directionSelect.innerHTML = '<option value="">Выберите направление</option>';
                    data.forEach(direction => {
                        const option = document.createElement('option');
                        option.value = direction.id;
                        option.textContent = `${direction.code} - ${direction.name}`;
                        directionSelect.appendChild(option);
                    });
                });
        } else {
            directionSelect.innerHTML = '<option value="">Сначала выберите факультет</option>';
        }
    });
    
    // Загрузка экзаменов при выборе направления
    directionSelect.addEventListener('change', function() {
        const directionId = this.value;
        const examsContainer = document.getElementById('required-exams');
        
        if (directionId) {
            fetch(`/api/direction-exams/?direction_id=${directionId}`)
                .then(response => response.json())
                .then(data => {
                    examsContainer.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(exam => {
                            const examDiv = document.createElement('div');
                            examDiv.className = 'exam-item';
                            examDiv.innerHTML = `
                                <label>${exam.name} (${exam.min_score}-${exam.max_score} баллов)</label>
                                <input type="number" name="exam_${exam.id}" 
                                    min="${exam.min_score}" max="${exam.max_score}" 
                                    class="form-input" required>
                            `;
                            examsContainer.appendChild(examDiv);
                        });
                    } else {
                        examsContainer.innerHTML = '<p class="text-muted">Для этого направления нет экзаменов</p>';
                    }
                });
        } else {
            examsContainer.innerHTML = '<p class="text-muted">Выберите направление для отображения экзаменов</p>';
        }
    });
});
</script>
{% endblock %}